<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://openvoiceos.github.io/community-docs/unused/context/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Conversational Context - OVOS User Documentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Conversational Context";
        var mkdocs_page_input_path = "unused/context.md";
        var mkdocs_page_url = "/community-docs/unused/context/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> OVOS User Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Home</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../..">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../about/">About</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Supported Hardware</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../hardware/">Introduction</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../hardware_audio/">Audio</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../hardware_video/">Video</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../architecture/">OpenVoiceOS Architecture</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Quick Start Guide</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../qs_intro/">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../qs_first_boot/">First Boot</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../qs_next_steps/">Next Steps</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Installation Options</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../install_intro/">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../qs_intro/">Installing an Image</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../install_ovos_core/">Install as a Library</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../install_ovos_docker/">Install with Docker</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../install_gui/">Install GUI</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Starting OVOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../starting_intro/">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../starting_modules/">Starting Modules</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../starting_systemd/">Starting Systemd</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../starting_docker.md">Starting Docker</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Configuration</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../config/">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../config_ovos_config/">Using ovos-config</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../config_manual_config/">Manualy Editing Files</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">How To</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../ht_intro/">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Skills</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../ht_skills/">Introduction</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ht_skills_install/">Installing Skills</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ht_skills_config/">Configuring</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">TTS</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../ht_tts/">Introduction</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ht_tts_config/">Configuring</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ht_change_voice/">Change Your Assistant's Voice</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Listener</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../ht_listener_intro/">Introduction</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ht_mic/">Microphone</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ht_stt/">STT</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ht_ww/">WakeWord/HotWords</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ht_vad/">VAD</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../ht_phal/">PHAL</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Homescreen</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../ht_config_homescreen/">Configuration</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../ht_config_security/">OpenVoiceOS Security</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Additional Services</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../selene_backend/">Selene Backend</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../personal_backend/">Personal Backend</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../kdeconnect/">KDE Connect</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Images</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../images_intro/">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../images_buildroot/">Buildroot</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../install_raspbian.md">Raspbian</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Other Builds</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../mycroft/">Mycroft</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../neonos/">NeonOS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Troubleshooting</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../troubleshooting_intro/">Introduction to Troubleshooting</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../troubleshooting_audio/">Troubleshooting Audio</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../troubleshooting_installation/">Troubleshooting Installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../troubleshooting_network/">Troubleshooting Network</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../troubleshooting_wakeword/">Troubleshooting Wakeword</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../troubleshooting_ovos_core/">Troubleshooting OVOS Core</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../troubleshooting_backend/">Troubleshooting Backend</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../troubleshooting_tts/">Troubleshooting TTS</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../troubleshooting_stt/">Troubleshooting STT</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../troubleshooting_skills/">Troubleshooting Skills</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../troubleshooting_plugins/">Troubleshooting Plugins</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Appendix</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../glossary/">Glossary</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../faq/">FAQ</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../compat.md">Compatibility</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../license/">License</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../friends/">Friends</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../members/">OVOS Members</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">OVOS User Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li class="breadcrumb-item active">Conversational Context</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="conversational-context">Conversational Context</h1>
<p><em>NOTE: Conversational context is currently only available with the</em> <a href="https://mycroft.ai/documentation/adapt"><em>Adapt</em></a> <em>Intent Parser, and is not yet available for</em> <a href="https://mycroft.ai/documentation/padatious"><em>Padatious</em></a></p>
<blockquote>
<p>How tall is John Cleese?</p>
</blockquote>
<p><code>"John Cleese is 196 centimeters"</code></p>
<blockquote>
<p>Where's he from?</p>
</blockquote>
<p><code>"He's from England"</code></p>
<p>Context is added manually by the <strong>Skill</strong> creator using either the <code>self.set_context()</code> method or the <code>@adds_context()</code> decorator.</p>
<p>Consider the following intent handlers:</p>
<pre><code class="language-python">    @intent_handler(IntentBuilder().require('PythonPerson').require('Length'))
    def handle_length(self, message):
        python = message.data.get('PythonPerson')
        self.speak('{} is {} cm tall'.format(python, length_dict[python]))

    @intent_handler(IntentBuilder().require('PythonPerson').require('WhereFrom'))
    def handle_from(self, message):
        python = message.data.get('PythonPerson')
        self.speak('{} is from {}'.format(python, from_dict[python]))
</code></pre>
<p>To interact with the above handlers the user would need to say</p>
<pre><code class="language-text">User: How tall is John Cleese?
Mycroft: John Cleese is 196 centimeters
User: Where is John Cleese from?
Mycroft: He's from England
</code></pre>
<p>To get a more natural response the functions can be changed to let OVOS know which <code>PythonPerson</code> we're talking about by using the <code>self.set_context()</code> method to give context:</p>
<pre><code class="language-python">    @intent_handler(IntentBuilder().require('PythonPerson').require('Length'))
    def handle_length(self, message):
        # PythonPerson can be any of the Monty Python members
        python = message.data.get('PythonPerson')
        self.speak('{} is {} cm tall'.format(python, length_dict[python]))
        self.set_context('PythonPerson', python)

    @intent_handler(IntentBuilder().require('PythonPerson').require('WhereFrom'))
    def handle_from(self, message):
        # PythonPerson can be any of the Monty Python members
        python = message.data.get('PythonPerson')
        self.speak('He is from {}'.format(from_dict[python]))
        self.set_context('PythonPerson', python)
</code></pre>
<p>When either of the methods are called the <code>PythonPerson</code> keyword is added to OVOS's context, which means that if there is a match with <code>Length</code> but <code>PythonPerson</code> is missing OVOS will assume the last mention of that keyword. The interaction can now become the one described at the top of the page.</p>
<blockquote>
<p>User: How tall is John Cleese?</p>
</blockquote>
<p>OVOS detects the <code>Length</code> keyword and the <code>PythonPerson</code> keyword</p>
<blockquote>
<p>OVOS: 196 centimeters</p>
</blockquote>
<p>John Cleese is added to the current context</p>
<blockquote>
<p>User: Where's he from?</p>
</blockquote>
<p>OVOS detects the <code>WhereFrom</code> keyword but not any <code>PythonPerson</code> keyword. The Context Manager is activated and returns the latest entry of <code>PythonPerson</code> which is <em>John Cleese</em></p>
<blockquote>
<p>OVOS: He's from England</p>
</blockquote>
<p>The context isn't limited by the keywords provided by the current <strong>Skill</strong>. For example</p>
<pre><code class="language-python">    @intent_handler(IntentBuilder().require(PythonPerson).require(WhereFrom))
    def handle_from(self, message):
        # PythonPerson can be any of the Monty Python members
        python = message.data.get('PythonPerson')
        self.speak('He is from {}'.format(from_dict[python]))
        self.set_context('PythonPerson', python)
        self.set_context('Location', from_dict[python])
</code></pre>
<p>Enables conversations with other <strong>Skills</strong> as well.</p>
<pre><code class="language-text">User: Where is John Cleese from?
Mycroft: He's from England
User: What's the weather like over there?
Mycroft: Raining and 14 degrees...
</code></pre>
<h2 id="using-context-to-enable-intents">Using context to enable <strong>Intents</strong></h2>
<p>To make sure certain <strong>Intents</strong> can't be triggered unless some previous stage in a conversation has occurred. Context can be used to create "bubbles" of available intent handlers.</p>
<pre><code class="language-text">User: Hey Mycroft, bring me some Tea
Mycroft: Of course, would you like Milk with that?
User: No
Mycroft: How about some Honey?
User: All right then
Mycroft: Here you go, here's your Tea with Honey
</code></pre>
<pre><code class="language-python">from mycroft.skills.context import adds_context, removes_context

class TeaSkill(MycroftSkill):
    @intent_handler(IntentBuilder('TeaIntent').require(&quot;TeaKeyword&quot;))
    @adds_context('MilkContext')
    def handle_tea_intent(self, message):
        self.milk = False
        self.speak('Of course, would you like Milk with that?',
                   expect_response=True)

    @intent_handler(IntentBuilder('NoMilkIntent').require(&quot;NoKeyword&quot;).
                                  require('MilkContext').build())
    @removes_context('MilkContext')
    @adds_context('HoneyContext')
    def handle_no_milk_intent(self, message):
        self.speak('all right, any Honey?', expect_response=True)

    @intent_handler(IntentBuilder('YesMilkIntent').require(&quot;YesKeyword&quot;).
                                  require('MilkContext').build())
    @removes_context('MilkContext')
    @adds_context('HoneyContext')
    def handle_yes_milk_intent(self, message):
        self.milk = True
        self.speak('What about Honey?', expect_response=True)

    @intent_handler(IntentBuilder('NoHoneyIntent').require(&quot;NoKeyword&quot;).
                                  require('HoneyContext').build())
    @removes_context('HoneyContext')
    def handle_no_honey_intent(self, message):
        if self.milk:
            self.speak('Heres your Tea with a dash of Milk')
        else:
            self.speak('Heres your Tea, straight up')

    @intent_handler(IntentBuilder('YesHoneyIntent').require(&quot;YesKeyword&quot;).
                                require('HoneyContext').build())
    @removes_context('HoneyContext')
    def handle_yes_honey_intent(self, message):
        if self.milk:
            self.speak('Heres your Tea with Milk and Honey')
        else:
            self.speak('Heres your Tea with Honey')
</code></pre>
<p>When starting up only the <code>TeaIntent</code> will be available. When that has been triggered and <em>MilkContext</em> is added the <code>MilkYesIntent</code> and <code>MilkNoIntent</code> are available since the <em>MilkContext</em> is set. when a <em>yes</em> or <em>no</em> is received the <em>MilkContext</em> is removed and can't be accessed. In it's place the <em>HoneyContext</em> is added making the <code>YesHoneyIntent</code> and <code>NoHoneyIntent</code> available.</p>
<p>You can find an example <a href="https://github.com/krisgesling/tea-skill">Tea Skill using conversational context on Github</a>.</p>
<p>As you can see, Conversational Context lends itself well to implementing a <a href="https://en.wikipedia.org/wiki/Dialog_tree">dialog tree or conversation tree</a>.</p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
